= iota-ssg Cookbook
:toc: left
:toc-title: Recipes
:toclevels: 3
:sectnums:
:icons: font
:source-highlighter: highlight.js

A comprehensive guide to all commands, recipes, and workflows in iota-ssg.

== Quick Reference

[cols="1,2,1", options="header"]
|===
|Category |Common Commands |Section

|Build |`just build`, `just check` |<<cli-recipes>>
|Test |`just test`, `just test-adapter zola` |<<cli-recipes>>
|Adapters |`just list-adapters`, `just adapter-info zola` |<<adapter-commands>>
|CI/CD |`just ci`, `must precommit` |<<cicd-recipes>>
|Hooks |`just hooks-install` |<<hooks-recipes>>
|===

[[cli-recipes]]
== CLI Recipes (Just)

The `justfile` provides convenient command-line recipes for common tasks.

=== Build Commands

[[build]]
==== `just build`
Run full build validation including syntax checks and linting.

[source,bash]
----
just build
----

[[check]]
==== `just check`
Check adapter syntax without running full build.

[source,bash]
----
just check
----

[[fmt]]
==== `just fmt`
Format all source files using Prettier.

[source,bash]
----
just fmt
----

[[lint]]
==== `just lint`
Run ESLint on all adapter files.

[source,bash]
----
just lint
----

[[clean]]
==== `just clean`
Remove build artifacts and caches.

[source,bash]
----
just clean
----

=== Test Commands

[[test]]
==== `just test`
Run all tests (unit and integration).

[source,bash]
----
just test
----

[[test-unit]]
==== `just test-unit`
Run unit tests only.

[source,bash]
----
just test-unit
----

[[test-adapter]]
==== `just test-adapter <name>`
Test a specific adapter by name.

[source,bash]
----
just test-adapter zola
just test-adapter hakyll
just test-adapter mdbook
----

[[test-adapters]]
==== `just test-adapters`
Test all adapters can be imported.

[source,bash]
----
just test-adapters
----

[[test-e2e]]
==== `just test-e2e`
Run end-to-end tests (planned for v0.4).

[source,bash]
----
just test-e2e
----

[[test-coverage]]
==== `just test-coverage`
Run tests with coverage reporting.

[source,bash]
----
just test-coverage
----

=== Development Commands

[[dev]]
==== `just dev`
Start development mode (alias for `just watch`).

[source,bash]
----
just dev
----

[[watch]]
==== `just watch`
Watch for file changes and run checks.

[source,bash]
----
just watch
----

[[serve-docs]]
==== `just serve-docs`
Start local documentation server.

[source,bash]
----
just serve-docs
# Then open http://localhost:8080
----

[[adapter-commands]]
== Adapter Commands

=== Listing and Information

[[list-adapters]]
==== `just list-adapters`
Show all available SSG adapters.

[source,bash]
----
just list-adapters
----

Output:
----
Available adapters:
babashka
cobalt
cryogen
...
zola
zotonic
----

[[count-adapters]]
==== `just count-adapters`
Count total number of adapters.

[source,bash]
----
just count-adapters
# Output: Total adapters: 28
----

[[adapter-info]]
==== `just adapter-info <name>`
Show detailed information about an adapter.

[source,bash]
----
just adapter-info zola
----

Output:
----
Name: Zola
Language: Rust
Description: Fast static site generator...
Tools:
  - zola_init: Initialize a new Zola site
  - zola_build: Build the Zola site
  - zola_serve: Start Zola development server
  - zola_check: Check the site for errors
  - zola_version: Get Zola version
----

=== Validation

[[validate-adapter]]
==== `just validate-adapter <name>`
Validate adapter interface compliance.

[source,bash]
----
just validate-adapter zola
----

[[validate-adapters]]
==== `just validate-adapters`
Validate all adapter interfaces.

[source,bash]
----
just validate-adapters
----

=== Synchronization

[[sync-from-hub]]
==== `just sync-from-hub`
Sync adapters from poly-ssg-mcp hub.

[source,bash]
----
just sync-from-hub
----

[[sync-status]]
==== `just sync-status`
Check synchronization status.

[source,bash]
----
just sync-status
----

[[must-commands]]
== Must Commands (Gates)

The `Mustfile` defines required checks that MUST pass before certain operations.

=== Gate Commands

[[must-precommit]]
==== `must precommit`
Required checks before any commit.

[source,bash]
----
source Mustfile && must precommit
# Or: bash Mustfile precommit
----

Includes:

* Lint check
* Syntax check
* No secrets check

[[must-premerge]]
==== `must premerge`
Required checks before merge to main.

[source,bash]
----
source Mustfile && must premerge
----

Includes:

* All precommit checks
* Tests pass
* Documentation exists

[[must-prerelease]]
==== `must prerelease`
Required checks before release.

[source,bash]
----
source Mustfile && must prerelease
----

Includes:

* All premerge checks
* CHANGELOG updated
* Valid semver version
* Security scan

=== Individual Checks

[cols="1,2", options="header"]
|===
|Command |Description

|`must syntax` |Check adapter syntax
|`must lint` |Run linters
|`must secrets` |Check for hardcoded secrets
|`must tests` |Run test suite
|`must docs` |Verify documentation exists
|`must changelog` |Verify CHANGELOG is updated
|`must version` |Validate semver version
|`must security` |Run security checks
|`must adapters` |Validate all adapter interfaces
|`must scm` |Verify SCM files present
|`must hooks` |Check git hooks installed
|`must all` |Run all checks
|===

[[cicd-recipes]]
== CI/CD Recipes

=== Local CI

[[ci]]
==== `just ci`
Run CI checks locally before pushing.

[source,bash]
----
just ci
----

Equivalent to:
[source,bash]
----
just check && just lint && just test
----

=== Release Preparation

[[release-prep]]
==== `just release-prep <version>`
Prepare for a release.

[source,bash]
----
just release-prep 0.3.0
----

Actions:

* Updates version in STATE.scm
* Reminds to update CHANGELOG.md

=== Container Commands

[[container-build]]
==== `just container-build`
Build the container image.

[source,bash]
----
just container-build
----

[[container-run]]
==== `just container-run`
Run the container.

[source,bash]
----
just container-run
----

[[hooks-recipes]]
== Hooks Configuration

=== Installation

[[hooks-install]]
==== `just hooks-install`
Install git hooks from `.githooks/` directory.

[source,bash]
----
just hooks-install
----

[[hooks-uninstall]]
==== `just hooks-uninstall`
Remove installed git hooks.

[source,bash]
----
just hooks-uninstall
----

=== Available Hooks

[cols="1,2", options="header"]
|===
|Hook |Purpose

|`pre-commit` |Runs `must precommit` before each commit
|`commit-msg` |Validates conventional commit format
|===

[[nickel-formulae]]
== Nickel Formulae

Nickel configuration evaluation (when available).

[[nickel-eval]]
==== `just nickel-eval <file>`
Evaluate a Nickel configuration file.

[source,bash]
----
just nickel-eval config.ncl
----

[[status-commands]]
== Status Commands

[[status]]
==== `just status`
Show project status summary.

[source,bash]
----
just status
----

Output:
----
=== iota-ssg Status ===
Adapters: 28
Git: 0 modified files
Branch: main
----

[[state]]
==== `just state`
Show SCM state summary from STATE.scm.

[source,bash]
----
just state
----

[[command-combinations]]
== Command Combinations

=== Common Workflows

==== Quick Development Check
[source,bash]
----
just check && just lint
----

==== Full Pre-Push Validation
[source,bash]
----
just ci && source Mustfile && must adapters
----

==== New Adapter Development
[source,bash]
----
# 1. Copy existing adapter
cp adapters/zola.js adapters/new-ssg.js

# 2. Edit the adapter
$EDITOR adapters/new-ssg.js

# 3. Validate
just validate-adapter new-ssg

# 4. Test
just test-adapter new-ssg

# 5. Full check
just ci
----

==== Release Workflow
[source,bash]
----
# 1. Run all gates
source Mustfile && must all

# 2. Prepare release
just release-prep 1.0.0

# 3. Update CHANGELOG
$EDITOR CHANGELOG.md

# 4. Commit and tag
git add -A
git commit -m "chore: release v1.0.0"
git tag -s v1.0.0

# 5. Push
git push && git push --tags
----

[[cli-permutations]]
== CLI Permutations

=== Adapter Testing Matrix

Test specific language families:

[source,bash]
----
# Rust SSGs
for ssg in zola cobalt mdbook; do just test-adapter $ssg; done

# Elixir SSGs
for ssg in serum tableau nimble-publisher; do just test-adapter $ssg; done

# Haskell SSGs
for ssg in hakyll ema; do just test-adapter $ssg; done

# Clojure SSGs
for ssg in babashka cryogen perun; do just test-adapter $ssg; done
----

=== Validation Matrix

[source,bash]
----
# Validate and show info for all adapters
for f in adapters/*.js; do
    name=$(basename "$f" .js)
    [ "$name" = "README" ] && continue
    echo "=== $name ==="
    just validate-adapter "$name" && just adapter-info "$name"
done
----

[[environment-variables]]
== Environment Variables

[cols="1,2,1", options="header"]
|===
|Variable |Purpose |Default

|`DENO_DIR` |Deno cache directory |`~/.cache/deno`
|`NO_COLOR` |Disable colored output |unset
|`CI` |Running in CI environment |unset
|===

[[troubleshooting]]
== Troubleshooting

=== Common Issues

==== "deno: command not found"
Install Deno:
[source,bash]
----
curl -fsSL https://deno.land/install.sh | sh
----

==== "eslint: command not found"
Linting is optional. Install if needed:
[source,bash]
----
npm install -g eslint
----

==== "prettier: command not found"
Formatting is optional. Install if needed:
[source,bash]
----
npm install -g prettier
----

==== Adapter fails to connect
1. Check SSG CLI is installed: `which <ssg-name>`
2. Verify it's in PATH
3. Test directly: `<ssg-name> --version`

[[appendix]]
== Appendix

=== File Locations

[cols="1,2", options="header"]
|===
|File |Purpose

|`justfile` |Just task runner recipes
|`Mustfile` |Required gate checks
|`adapters/*.js` |SSG adapter implementations
|`*.scm` |SCM configuration files
|`.github/workflows/*.yml` |CI/CD pipelines
|`.githooks/*` |Git hook scripts
|===

=== Version History

[cols="1,1,2", options="header"]
|===
|Version |Date |Changes

|0.3.0 |2025-12-17 |Added cookbook, full CI/CD, hooks
|0.2.0 |2025-12-17 |Documentation and security complete
|0.1.0 |2025-12-15 |Initial setup with adapters
|===

---

_Generated for iota-ssg. See link:README.adoc[README] for project overview._
